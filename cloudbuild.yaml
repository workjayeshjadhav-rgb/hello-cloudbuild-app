steps:
# Run unit tests
- name: 'python:3.7-slim'
  id: Test
  entrypoint: /bin/sh
  args:
  - -c
  - 'pip install flask && python test_app.py -v'

# Build image
- name: 'gcr.io/cloud-builders/docker'
  id: Build
  args:
  - build
  - -t
  - us-west1-docker.pkg.dev/$PROJECT_ID/my-repository/hello-cloudbuild:$SHORT_SHA
  - .

# Push image
- name: 'gcr.io/cloud-builders/docker'
  id: Push
  args:
  - push
  - us-west1-docker.pkg.dev/$PROJECT_ID/my-repository/hello-cloudbuild:$SHORT_SHA

options:
  logging: CLOUD_LOGGING_ONLY
